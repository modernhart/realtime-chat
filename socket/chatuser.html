<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<style>
	.user{
		height: 200px;
		position: relative;
	}
	#chat{
		height: initial;
	}

</style>
<title>real time random chat</title>
</head>
<body>
	<div class="container">
		<!-- 유저 리스트 출력 -->
		<h1>connection User</h1>
		<div class="user" id="user">

		</div>
	</div>
<div class="container">
	<h1>my nodejs Application socket.io</h1>
    <form class="form-inline">
      <div class="form-group">
        <label for="msgForm">Message: </label>
        <input type="text" class="form-control" id="msgForm" size="50" required>
      </div>
      <button type="submit" class="btn btn-primary">Send</button>
    </form>
    <div id="chat" class="form-control"></div>
  </div>
</body>
<script>
$(function(){

	//클라이언트 스크립트
	var socket = io();
	socket.on('join_notice',function(name){
		$("#chat").append("<p>"+name+" has joined!</p>");
	});

	$("form").submit(function(e){
		e.preventDefault();
		var msg = $("#msgForm");

		socket.emit('chat',{msg : msg.val(), name: name});
		msg.val("");
	});

	//접속 중 유저목록
	socket.on('ulist',function(userlist){
		$("#user").empty();
		$.each(userlist, function(index, value){
			$("#user").append("<p>"+value+"</p>");
		});
	});
	//whoami
	socket.on("whoami",function(name){
		$("#msgForm").attr('placeholder',name);
	});

	socket.on('chat',function(data){
		$("#chat").append("<p style='color:blue;'>"+data.name+" : "+data.msg+"</p>");
	});
	socket.on('disconnect',function(data){
		$("#chat").append("<p style='color:red;'>"+data+" has left </p>");
	});

});
</script>
</html>
